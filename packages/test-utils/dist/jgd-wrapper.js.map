{"version":3,"file":"jgd-wrapper.js","names":["configureJimp","configure","types","mime","constants","MIME_PNG","hasAlpha","decoders","PNG","sync","read","encoders","data","png","width","bitmap","height","bitDepth","deflateLevel","_deflateLevel","deflateStrategy","_deflateStrategy","filterType","_filterType","colorType","_rgba","inputHasAlpha","write","Jimp","window","appendConstructorOption","jgd","length","resolve","reject","JGD","decode","prototype","getJGDSync","encode","getJGD","Promise","error"],"sources":["../src/jgd-wrapper.js"],"sourcesContent":["import configure from '@jimp/custom';\nimport { PNG } from 'pngjs';\n\nimport JGD from './jgd';\n\nfunction configureJimp() {\n  return configure({\n    types: [\n      () => ({\n        mime: { 'image/png': ['png'] },\n\n        constants: {\n          MIME_PNG: 'image/png'\n        },\n\n        hasAlpha: { 'image/png': true },\n        decoders: { 'image/png': PNG.sync.read },\n        encoders: {\n          'image/png': data => {\n            const png = new PNG({\n              width: data.bitmap.width,\n              height: data.bitmap.height,\n              bitDepth: 8,\n              deflateLevel: data._deflateLevel,\n              deflateStrategy: data._deflateStrategy,\n              filterType: data._filterType,\n              colorType: data._rgba ? 6 : 2,\n              inputHasAlpha: true\n            });\n\n            png.data = data.bitmap.data;\n\n            return PNG.sync.write(png);\n          }\n        }\n      })\n    ]\n  });\n}\n\nconst Jimp =\n  typeof window !== 'undefined' && window.Jimp ? window.Jimp : configureJimp();\n\n/**\n * Jimp constructor (from a JGD object)\n * @param data a JGD object containing the image data\n * @param cb a function to call when the image is parsed to a bitmap\n */\nJimp.appendConstructorOption(\n  'build from JGD object',\n  jgd =>\n    typeof jgd === 'object' &&\n    typeof jgd.width === 'number' &&\n    typeof jgd.height === 'number' &&\n    typeof jgd.data.length === 'number',\n  function(resolve, reject, jgd) {\n    // `this` points to a Jimp instance\n    this.bitmap = JGD.decode(jgd);\n    resolve();\n  }\n);\n\n/**\n * Converts the image to a JGD object (sync fashion)\n * @returns {JGD}  JGD object\n */\nJimp.prototype.getJGDSync = function() {\n  return JGD.encode(this.bitmap);\n};\n\n/**\n * Converts the image to a JGD object (async fashion)\n * @param {function(Error, Jimp)} cb a Node-style function to call with the buffer as the second argument\n * @returns {Jimp}  this for chaining of methods\n */\nJimp.prototype.getJGD = function() {\n  return new Promise((resolve, reject) => {\n    try {\n      resolve(this.getJGDSync());\n    } catch (error) {\n      return reject(error);\n    }\n  });\n};\n\nexport default Jimp;\n"],"mappings":";;;;;;;;;;;AAAA;;AACA;;AAEA;;AAEA,SAASA,aAAT,GAAyB;EACvB,OAAO,IAAAC,kBAAA,EAAU;IACfC,KAAK,EAAE,CACL;MAAA,OAAO;QACLC,IAAI,EAAE;UAAE,aAAa,CAAC,KAAD;QAAf,CADD;QAGLC,SAAS,EAAE;UACTC,QAAQ,EAAE;QADD,CAHN;QAOLC,QAAQ,EAAE;UAAE,aAAa;QAAf,CAPL;QAQLC,QAAQ,EAAE;UAAE,aAAaC,UAAA,CAAIC,IAAJ,CAASC;QAAxB,CARL;QASLC,QAAQ,EAAE;UACR,aAAa,kBAAAC,IAAI,EAAI;YACnB,IAAMC,GAAG,GAAG,IAAIL,UAAJ,CAAQ;cAClBM,KAAK,EAAEF,IAAI,CAACG,MAAL,CAAYD,KADD;cAElBE,MAAM,EAAEJ,IAAI,CAACG,MAAL,CAAYC,MAFF;cAGlBC,QAAQ,EAAE,CAHQ;cAIlBC,YAAY,EAAEN,IAAI,CAACO,aAJD;cAKlBC,eAAe,EAAER,IAAI,CAACS,gBALJ;cAMlBC,UAAU,EAAEV,IAAI,CAACW,WANC;cAOlBC,SAAS,EAAEZ,IAAI,CAACa,KAAL,GAAa,CAAb,GAAiB,CAPV;cAQlBC,aAAa,EAAE;YARG,CAAR,CAAZ;YAWAb,GAAG,CAACD,IAAJ,GAAWA,IAAI,CAACG,MAAL,CAAYH,IAAvB;YAEA,OAAOJ,UAAA,CAAIC,IAAJ,CAASkB,KAAT,CAAed,GAAf,CAAP;UACD;QAhBO;MATL,CAAP;IAAA,CADK;EADQ,CAAV,CAAP;AAgCD;;AAED,IAAMe,IAAI,GACR,OAAOC,MAAP,KAAkB,WAAlB,IAAiCA,MAAM,CAACD,IAAxC,GAA+CC,MAAM,CAACD,IAAtD,GAA6D5B,aAAa,EAD5E;AAGA;AACA;AACA;AACA;AACA;;AACA4B,IAAI,CAACE,uBAAL,CACE,uBADF,EAEE,UAAAC,GAAG;EAAA,OACD,yBAAOA,GAAP,MAAe,QAAf,IACA,OAAOA,GAAG,CAACjB,KAAX,KAAqB,QADrB,IAEA,OAAOiB,GAAG,CAACf,MAAX,KAAsB,QAFtB,IAGA,OAAOe,GAAG,CAACnB,IAAJ,CAASoB,MAAhB,KAA2B,QAJ1B;AAAA,CAFL,EAOE,UAASC,OAAT,EAAkBC,MAAlB,EAA0BH,GAA1B,EAA+B;EAC7B;EACA,KAAKhB,MAAL,GAAcoB,eAAA,CAAIC,MAAJ,CAAWL,GAAX,CAAd;EACAE,OAAO;AACR,CAXH;AAcA;AACA;AACA;AACA;;AACAL,IAAI,CAACS,SAAL,CAAeC,UAAf,GAA4B,YAAW;EACrC,OAAOH,eAAA,CAAII,MAAJ,CAAW,KAAKxB,MAAhB,CAAP;AACD,CAFD;AAIA;AACA;AACA;AACA;AACA;;;AACAa,IAAI,CAACS,SAAL,CAAeG,MAAf,GAAwB,YAAW;EAAA;;EACjC,OAAO,IAAIC,OAAJ,CAAY,UAACR,OAAD,EAAUC,MAAV,EAAqB;IACtC,IAAI;MACFD,OAAO,CAAC,KAAI,CAACK,UAAL,EAAD,CAAP;IACD,CAFD,CAEE,OAAOI,KAAP,EAAc;MACd,OAAOR,MAAM,CAACQ,KAAD,CAAb;IACD;EACF,CANM,CAAP;AAOD,CARD;;eAUed,I"}
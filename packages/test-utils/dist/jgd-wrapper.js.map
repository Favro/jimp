{"version":3,"sources":["../src/jgd-wrapper.js"],"names":["configureJimp","types","mime","constants","MIME_PNG","hasAlpha","decoders","PNG","sync","read","encoders","data","png","width","bitmap","height","bitDepth","deflateLevel","_deflateLevel","deflateStrategy","_deflateStrategy","filterType","_filterType","colorType","_rgba","inputHasAlpha","write","Jimp","window","appendConstructorOption","jgd","length","resolve","reject","JGD","decode","prototype","getJGDSync","encode","getJGD","Promise","error"],"mappings":";;;;;;;;;;;AAAA;;AACA;;AAEA;;AAEA,SAASA,aAAT,GAAyB;AACvB,SAAO,wBAAU;AACfC,IAAAA,KAAK,EAAE,CACL;AAAA,aAAO;AACLC,QAAAA,IAAI,EAAE;AAAE,uBAAa,CAAC,KAAD;AAAf,SADD;AAGLC,QAAAA,SAAS,EAAE;AACTC,UAAAA,QAAQ,EAAE;AADD,SAHN;AAOLC,QAAAA,QAAQ,EAAE;AAAE,uBAAa;AAAf,SAPL;AAQLC,QAAAA,QAAQ,EAAE;AAAE,uBAAaC,WAAIC,IAAJ,CAASC;AAAxB,SARL;AASLC,QAAAA,QAAQ,EAAE;AACR,uBAAa,kBAAAC,IAAI,EAAI;AACnB,gBAAMC,GAAG,GAAG,IAAIL,UAAJ,CAAQ;AAClBM,cAAAA,KAAK,EAAEF,IAAI,CAACG,MAAL,CAAYD,KADD;AAElBE,cAAAA,MAAM,EAAEJ,IAAI,CAACG,MAAL,CAAYC,MAFF;AAGlBC,cAAAA,QAAQ,EAAE,CAHQ;AAIlBC,cAAAA,YAAY,EAAEN,IAAI,CAACO,aAJD;AAKlBC,cAAAA,eAAe,EAAER,IAAI,CAACS,gBALJ;AAMlBC,cAAAA,UAAU,EAAEV,IAAI,CAACW,WANC;AAOlBC,cAAAA,SAAS,EAAEZ,IAAI,CAACa,KAAL,GAAa,CAAb,GAAiB,CAPV;AAQlBC,cAAAA,aAAa,EAAE;AARG,aAAR,CAAZ;AAWAb,YAAAA,GAAG,CAACD,IAAJ,GAAWA,IAAI,CAACG,MAAL,CAAYH,IAAvB;AAEA,mBAAOJ,WAAIC,IAAJ,CAASkB,KAAT,CAAed,GAAf,CAAP;AACD;AAhBO;AATL,OAAP;AAAA,KADK;AADQ,GAAV,CAAP;AAgCD;;AAED,IAAMe,IAAI,GACR,OAAOC,MAAP,KAAkB,WAAlB,IAAiCA,MAAM,CAACD,IAAxC,GAA+CC,MAAM,CAACD,IAAtD,GAA6D3B,aAAa,EAD5E;AAGA;;;;;;AAKA2B,IAAI,CAACE,uBAAL,CACE,uBADF,EAEE,UAAAC,GAAG;AAAA,SACD,yBAAOA,GAAP,MAAe,QAAf,IACA,OAAOA,GAAG,CAACjB,KAAX,KAAqB,QADrB,IAEA,OAAOiB,GAAG,CAACf,MAAX,KAAsB,QAFtB,IAGA,OAAOe,GAAG,CAACnB,IAAJ,CAASoB,MAAhB,KAA2B,QAJ1B;AAAA,CAFL,EAOE,UAASC,OAAT,EAAkBC,MAAlB,EAA0BH,GAA1B,EAA+B;AAC7B;AACA,OAAKhB,MAAL,GAAcoB,gBAAIC,MAAJ,CAAWL,GAAX,CAAd;AACAE,EAAAA,OAAO;AACR,CAXH;AAcA;;;;;AAIAL,IAAI,CAACS,SAAL,CAAeC,UAAf,GAA4B,YAAW;AACrC,SAAOH,gBAAII,MAAJ,CAAW,KAAKxB,MAAhB,CAAP;AACD,CAFD;AAIA;;;;;;;AAKAa,IAAI,CAACS,SAAL,CAAeG,MAAf,GAAwB,YAAW;AAAA;;AACjC,SAAO,IAAIC,OAAJ,CAAY,UAACR,OAAD,EAAUC,MAAV,EAAqB;AACtC,QAAI;AACFD,MAAAA,OAAO,CAAC,KAAI,CAACK,UAAL,EAAD,CAAP;AACD,KAFD,CAEE,OAAOI,KAAP,EAAc;AACd,aAAOR,MAAM,CAACQ,KAAD,CAAb;AACD;AACF,GANM,CAAP;AAOD,CARD;;eAUed,I","sourcesContent":["import configure from '@jimp/custom';\nimport { PNG } from 'pngjs';\n\nimport JGD from './jgd';\n\nfunction configureJimp() {\n  return configure({\n    types: [\n      () => ({\n        mime: { 'image/png': ['png'] },\n\n        constants: {\n          MIME_PNG: 'image/png'\n        },\n\n        hasAlpha: { 'image/png': true },\n        decoders: { 'image/png': PNG.sync.read },\n        encoders: {\n          'image/png': data => {\n            const png = new PNG({\n              width: data.bitmap.width,\n              height: data.bitmap.height,\n              bitDepth: 8,\n              deflateLevel: data._deflateLevel,\n              deflateStrategy: data._deflateStrategy,\n              filterType: data._filterType,\n              colorType: data._rgba ? 6 : 2,\n              inputHasAlpha: true\n            });\n\n            png.data = data.bitmap.data;\n\n            return PNG.sync.write(png);\n          }\n        }\n      })\n    ]\n  });\n}\n\nconst Jimp =\n  typeof window !== 'undefined' && window.Jimp ? window.Jimp : configureJimp();\n\n/**\n * Jimp constructor (from a JGD object)\n * @param data a JGD object containing the image data\n * @param cb a function to call when the image is parsed to a bitmap\n */\nJimp.appendConstructorOption(\n  'build from JGD object',\n  jgd =>\n    typeof jgd === 'object' &&\n    typeof jgd.width === 'number' &&\n    typeof jgd.height === 'number' &&\n    typeof jgd.data.length === 'number',\n  function(resolve, reject, jgd) {\n    // `this` points to a Jimp instance\n    this.bitmap = JGD.decode(jgd);\n    resolve();\n  }\n);\n\n/**\n * Converts the image to a JGD object (sync fashion)\n * @returns {JGD}  JGD object\n */\nJimp.prototype.getJGDSync = function() {\n  return JGD.encode(this.bitmap);\n};\n\n/**\n * Converts the image to a JGD object (async fashion)\n * @param {function(Error, Jimp)} cb a Node-style function to call with the buffer as the second argument\n * @returns {Jimp}  this for chaining of methods\n */\nJimp.prototype.getJGD = function() {\n  return new Promise((resolve, reject) => {\n    try {\n      resolve(this.getJGDSync());\n    } catch (error) {\n      return reject(error);\n    }\n  });\n};\n\nexport default Jimp;\n"],"file":"jgd-wrapper.js"}